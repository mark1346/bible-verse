<!doctype html>

<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <link href="main.scss" rel="stylesheet">
    <link href="scripture.scss" rel="stylesheet">
    <title>Bible API Application by Sunghyun Han</title>
  </head>

  <body>

    <header>
      <div id="rachel-photo" class="container">
      </div>
    </header>

    <div class="subheader">
      <div class="container flex">

        <div class="subheadings">
          <h2>Verse of the Day:</h2>
          <h3 id="viewing"><span id="verse"></span></h3>
        </div>
      </div>
    </div>

    <main class="container">
      <div id="verse-content" class="verse-container"></div>
    </main>

    <script>
        const rachelRef = document.querySelector('#rachel-photo');

        const RACHELS = [
            'rachel.jpg',
            'rachel2.jpg',
            'rachel3.jpg',
            'rachel4.jpg',
            'rachel5.jpg',
            'rachel6.jpg',
            'rachel7.jpg',
            'rachel8.jpg',
            'rachel9.jpg',
        ];

        const randomRachel = Math.floor(Math.random() * RACHELS.length);
        const rachelID = RACHELS[randomRachel];

        
        var img = document.createElement('img');
        img.src = rachelID;
        img.setAttribute('width', 'auto');
        img.setAttribute('height', '300');
        img.alt = 'Rachel being loaded';
        rachelRef.appendChild(img);
        
    </script>

    <script src="my_key.js"></script>
    <script type="text/javascript" src="https://pkg.api.bible/fumsV3.min.js"></script>
    <script>
      /* This code ensures that FUMS will be reported correctly even if fumsV3.min.js has not finished loading before an attempt is made. */
      window.fumsData = window.fumsData || [];
      window.fums = window.fums || function () {
        window.fumsData.push(arguments);
      };
    </script>

    <script>
      const verse = document.querySelector(`#verse-content`);
      const verseRef = document.querySelector(`#verse`);

      const BIBLE_ID = `de4e12af7f28f599-01`;
      const VERSES = [ 
        '1THES.5.16-18',
        'ISA.41.10',
        '2COR.9.8',
        'ISA.43.1',
        '1COR.10.13',
        'HEB.12.2',
        'JHN.3.16-17',
        `ISA.40.31`,
        'MAT.11.28-30',
        'JER.29.11',
        'PRO.3.5-6',
        'PSA.27.1',
        'JHN.14.6',
        'JOS.1.9',
        'HEB.13.8',
        'JHN.13.1'
      ];

      const randomIndex = Math.floor(Math.random() * VERSES.length);
      const verseID = VERSES[randomIndex];

      getResults(verseID).then((data) => {
        const passage = data.passages[0];
        verseRef.innerHTML = `<span><i>${passage.reference}</i></span>`;
        verse.innerHTML = `<div class="text eb-container">${passage.content}</div>`;
      });

      /**
       * Gets verse(s) that matches verseID from API.Bible
       * @returns {Promise} containing verse
       */
      function getResults(verseID) {
        return new Promise((resolve, reject) => {
          const xhr = new XMLHttpRequest();
          xhr.withCredentials = false;

          xhr.addEventListener(`readystatechange`, function() {
            if (this.readyState === this.DONE) {
              const {data, meta} = JSON.parse(this.responseText);

              fums(`trackview`,meta.fumsToken);
              resolve(data);
            }
          });

          xhr.open(`GET`, `https://api.scripture.api.bible/v1/bibles/${BIBLE_ID}/search?query=${verseID}`);
          xhr.setRequestHeader(`api-key`, API_KEY);

          xhr.onerror = () => reject(xhr.statusText);

          xhr.send();
        });
      }
    </script>
  </body>
</html>